<!DOCTYPE html>
<html lang="fr">
<head>
    <title>A Simple hosted game.</title>
    <meta charset="utf-8">
<style>
    .hide {
        display: none;
    }
    .show {
        display: inline-block;
    }
</style>
</head>
<body>
<h1 id="titre">Welcome to a simple hosted game!</h1>
<div id="divGame" class="hide">
  <canvas id="ctx" width="500" height="500" style="border: 1px solid"></canvas>
</div>
<div id="divSignIn">
  <input id="pseudo" type="text">
  <input id="password" type="text">
  <button onclick="happy()">envoyer</button>
</div>
<div id="chat-text" class="hide">
    <div>Hello !</div>
</div>
<form id="chat-form" class="hide">
    <input type="text" id="chat-input" style="width:500px">
</form>
<script src="socket.io/socket.io.js"></script>
<script>
    var socket = io();
    var username = document.getElementById('pseudo').value;
    var password = document.getElementById('password').value;
    var ctx = document.getElementById('ctx').getContext("2d");
    var divGame = document.getElementById('divGame');
    ctx.font = "30px Courier New";
    var chatText = document.getElementById('chat-text');
    var chatInput = document.getElementById('chat-input');
    var chatForm = document.getElementById('chat-form');
    var titre = document.getElementById('titre');
    var happy = function() {
      socket.emit('signIn', {'user' : username, 'password' : password});
    };
    socket.on('signInResponse', function (data) {
          divGame.classList.remove('hide');
          chatText.classList.remove('hide');
          chatForm.classList.remove('hide');
          divSignIn.classList.add('hide');
          titre.innerHTML = data.msg;
        });

    socket.on('newPositions', function (data) {

        ctx.clearRect(0,0,500,500);

            for(var i = 0; i < data.length; i++){

                ctx.fillText(data[i].number, data[i].x, data[i].y);
            }

        });
    socket.on('addToChat', function(data){
        chatText.innerHTML = "<div>" + data + "</div>"
    });
    socket.on('evalAnswer', function(data){
        console.log(data);
    });

    chatForm.onsubmit = function(e){
        e.preventDefault();
        if(chatInput.value[0] === '/'){
            socket.emit('evalServer', chatInput.value.slice(1));
        } else {
            socket.emit('sendMsgToServer',chatInput.value);
        }
        chatInput.value = "";
    }

        document.onkeydown = function(event){
            if(event.keyCode === 68)      // d
                socket.emit('keyPress', {inputId:'right', state: true});
            else if(event.keyCode === 83)    // s
                socket.emit('keyPress', { inputId: 'down', state: true });
            else if (event.keyCode === 81)    // a
                socket.emit('keyPress', { inputId: 'left', state: true });
            else if (event.keyCode === 90)    // w
                socket.emit('keyPress', { inputId: 'up', state: true });
        }
        document.onkeyup = function (event) {
                if (event.keyCode === 68)      // d
                    socket.emit('keyPress', { inputId: 'right', state: false });
                else if (event.keyCode === 83)    // s
                    socket.emit('keyPress', { inputId: 'down', state: false });
                else if (event.keyCode === 81)    // q
                    socket.emit('keyPress', { inputId: 'left', state: false });
                else if (event.keyCode === 90)    // z
                    socket.emit('keyPress', { inputId: 'up', state: false });
            }

</script>
</body>
</html>
